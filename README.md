## 

### 代码搜索 search
#### 准确搜索
通过文件相对路径 搜索代码片段

#### 模糊搜索
通过文件名 分解关键字 通过关键字和文件名 获取文件相对路径 搜索代码片段

### 路径
- 全仓路径
- 相对路径

### 标记
5. 开源标记
7. 文件标记 hash
8. 仓库标记 commit
9. 增量标记 commit_id -> hash
10. 标记结构
11. 标记对象

### 业务
#### 提交信息读取
协程模型
1. 读取最新的提交信息
2. 读取一段时间的提交信息

#### 并行操作
1. 仓库级 git操作
2. 文件级 非git操作
3. 标记分析 协程 顶层任务

#### 标记分析 tag
1. 获取对象近N年的标记来源
2. 通过标记器获取得到标记

##### 标记器
1. 开源标记器 提交信息 -> 开源
2. 仓库分支标记器 最新提交信息
3. 文件提交标记器 最新提交信息 / 文件hash
4. 文件标记器 

#### 数据表增量更新 update
1. 当仓库源对应分支的commit变动时
2. 获取两次变动中的仓库信息变更 刷新仓库标记
3. 获取两次变动中的文件信息变更 刷新文件标记

#### 自动分表
1. 记录仓库表中每个仓库源的数据量并记录在分表路由中
2. 当分表路由对应仓库的数量大于一阈值时创建仓库分表
3. 删除清除来源数据

#### 建表 load
1. 读取仓库文件 建立仓库文件表
2. 读取仓库信息 建立仓库提交标记表
3. 读取文件提交信息 建立文件提交标记表
4. 读取仓库文件表 建立模糊搜索表

#### 文件映射
1. 编译文件映射

#### 筛选 query
1. 通过标记表筛选并打印数据信息

### 结构
1. 仓库分支文件
2. 并行式建表
3. 数据库结构
4. 仓库分表

### 表结构
- 分表路由 源表 索引 记录数量 是否分表 分表名 
- 仓库文件表 !仓库源 分支名 文件相对路径 文件hash
- 模糊搜索表 文件名 文件相对路径 标记
- 仓库提交标记表 !仓库源 分支名 分支commit 开源标记 !时间
- 文件标记表 !仓库源 !分支名 !文件相对路径 文件hash 开源标记
- 分表

### 提问
#### 为什么要使用文件hash标记不使用文件commit id
因为文件commit id需要用到git命令对异步有影响
#### 为什么不使用外键信息标记文件
提供自动化的分表能力
